<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mico's Micro Farm Agile</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sky-light: #e0f2fe;
            --sky-blue: #0ea5e9;
            --sky-deep: #0284c7;
            --plant-light: #dcfce7;
            --plant-green: #10b981;
            --plant-dark: #059669;
            --earth-cream: #fefce8;
            --earth-tan: #fef3c7;
            --sage: #84cc16;
            --moss: #65a30d;
            --ocean: #0891b2;
            --forest: #14532d;
            --coral: #f97316;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #cbd5e1;
            --white: #ffffff;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--sky-light) 0%, var(--plant-light) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: var(--white);
            padding: 32px 40px;
            border-radius: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px var(--shadow);
            border-left: 6px solid var(--sky-blue);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--sky-deep) 0%, var(--plant-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: var(--plant-light);
            border-radius: 20px;
            font-size: 12px;
            color: var(--plant-dark);
            font-weight: 600;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            background: var(--plant-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: var(--white);
            padding: 8px;
            border-radius: 16px;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .tab {
            padding: 14px 28px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: var(--sky-light);
            color: var(--sky-deep);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--sky-blue) 0%, var(--plant-green) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        .column {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            min-height: 400px;
            box-shadow: 0 2px 15px var(--shadow);
            border-top: 4px solid var(--border);
            transition: all 0.3s ease;
        }

        .column.not-started {
            border-top-color: var(--sky-blue);
        }

        .column.in-progress {
            border-top-color: var(--sage);
        }

        .column.done {
            border-top-color: var(--plant-green);
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .column-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .column-count {
            background: var(--earth-tan);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .column-add-btn {
            background: var(--sky-blue);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            line-height: 1;
        }

        .column-add-btn:hover {
            background: var(--sky-deep);
            transform: scale(1.1);
        }

        .task-card {
            background: var(--white);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 14px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid var(--border);
            border-left-width: 5px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .task-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .task-card.priority-high {
            border-left-color: #dc2626;
        }

        .task-card.priority-medium {
            border-left-color: var(--sage);
        }

        .task-card.priority-low {
            border-left-color: var(--sky-blue);
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .task-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            line-height: 1.4;
        }

        .task-owner-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-left: 8px;
            white-space: nowrap;
        }

        .owner-trey { background: var(--forest); }
        .owner-halie { background: var(--ocean); }
        .owner-ricardo { background: var(--coral); }
        .owner-team { background: var(--plant-green); }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .task-badge {
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        .urgency-this-week {
            background: #fee2e2;
            color: #991b1b;
        }

        .urgency-next-week {
            background: #fef3c7;
            color: #92400e;
        }

        .urgency-this-month {
            background: var(--sky-light);
            color: var(--sky-deep);
        }

        .urgency-future {
            background: #f1f5f9;
            color: var(--text-secondary);
        }

        .priority-badge {
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        .priority-high {
            background: #fee2e2;
            color: #991b1b;
        }

        .priority-medium {
            background: #fef9c3;
            color: #713f12;
        }

        .priority-low {
            background: var(--plant-light);
            color: var(--plant-dark);
        }

        .task-date {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-notes {
            margin-top: 10px;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .task-menu-button {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: transparent;
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            line-height: 1;
            transition: all 0.2s;
        }

        .task-menu-button:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .task-menu-dropdown {
            position: absolute;
            bottom: 40px;
            right: 12px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
            min-width: 120px;
        }

        .task-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: background 0.2s;
            border: none;
            width: 100%;
            text-align: left;
            background: white;
        }

        .task-menu-item:first-child {
            border-radius: 8px 8px 0 0;
        }

        .task-menu-item:last-child {
            border-radius: 0 0 8px 8px;
        }

        .task-menu-item:hover {
            background: var(--sky-light);
        }

        .task-menu-item.delete {
            color: #991b1b;
        }

        .task-menu-item.delete:hover {
            background: #fee2e2;
        }

        .task-menu-item.move {
            position: relative;
        }

        .task-submenu {
            position: absolute;
            left: -130px;
            top: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 140px;
        }

        .task-submenu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: background 0.2s;
            border: none;
            width: 100%;
            text-align: left;
            background: white;
        }

        .task-submenu-item:first-child {
            border-radius: 8px 8px 0 0;
        }

        .task-submenu-item:last-child {
            border-radius: 0 0 8px 8px;
        }

        .task-submenu-item:hover {
            background: var(--sky-light);
        }

        .task-card {
            position: relative;
        }

        .add-task-btn {
            width: 100%;
            padding: 14px;
            background: var(--white);
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .add-task-btn:hover {
            border-color: var(--sky-blue);
            color: var(--sky-blue);
            background: var(--sky-light);
        }

        .timeline-view, .calendar-view, .vendors-view {
            background: var(--white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .timeline-section {
            margin-bottom: 40px;
        }

        .timeline-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--plant-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timeline-tasks {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .vendor-card {
            background: linear-gradient(135deg, var(--sky-light) 0%, var(--plant-light) 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border-left: 5px solid var(--plant-green);
            box-shadow: 0 2px 10px var(--shadow);
        }

        .vendor-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .vendor-info {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.8;
        }

        .vendor-info div {
            margin-bottom: 6px;
        }

        .vendor-info strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            padding: 40px;
            max-width: 550px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 28px;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--sky-blue);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--sky-blue) 0%, var(--plant-green) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        }

        .btn-secondary {
            background: var(--earth-tan);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--border);
        }

        .calendar-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--sky-deep) 0%, var(--plant-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .legend {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .view-filter {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .view-filter-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .view-filter-select {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-filter-select:hover {
            border-color: var(--sky-blue);
        }

        .view-filter-select:focus {
            outline: none;
            border-color: var(--sky-blue);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .sprint-header {
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sprint-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .sprint-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .sprint-dates {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .sprint-goal {
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 2px;
        }

        .sprint-selector {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sprint-select {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            min-width: 150px;
        }

        .sprint-alert {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #dc2626;
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sprint-alert-icon {
            font-size: 24px;
        }

        .sprint-alert-text {
            font-size: 15px;
            font-weight: 600;
            color: #991b1b;
        }

        .btn-create-sprint {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--sky-blue) 0%, var(--plant-green) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .planning-board-container {
            display: flex;
            gap: 20px;
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .planning-backlog-fixed {
            flex-shrink: 0;
            width: 280px;
        }

        .planning-sprints-scroll {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            overflow-y: visible;
            flex: 1;
        }

        .planning-board {
            display: grid;
            grid-template-columns: repeat(13, minmax(250px, 1fr));
            gap: 20px;
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            overflow-x: auto;
            overflow-y: visible;
        }

        .planning-column {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            border: 2px solid var(--border);
            min-height: 500px;
        }

        .planning-column.backlog {
            border-top: 4px solid var(--coral);
        }

        .planning-column.sprint {
            border-top: 4px solid var(--sky-blue);
        }

        .planning-column-header {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .planning-column-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .planning-column-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .planning-task-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s;
        }

        .planning-task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .planning-task-card.dragging {
            opacity: 0.5;
        }

        .planning-task-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .planning-task-meta {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .planning-task-size {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            background: var(--earth-tan);
            color: var(--text-primary);
            font-weight: 600;
        }

        .drag-indicator {
            text-align: center;
            padding: 20px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 6px;
        }

        .setup-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            padding: 20px 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            border-left: 4px solid #f97316;
        }

        .setup-banner h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #92400e;
        }

        .setup-banner p {
            font-size: 14px;
            color: #78350f;
            line-height: 1.6;
        }

        .setup-banner code {
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDXTytDXonkcj9A3XuzCeV1F4V-Sfa51Ug",
            authDomain: "mico-s-micro-farm-agile.firebaseapp.com",
            databaseURL: "https://mico-s-micro-farm-agile-default-rtdb.firebaseio.com",
            projectId: "mico-s-micro-farm-agile",
            storageBucket: "mico-s-micro-farm-agile.firebasestorage.app",
            messagingSenderId: "899003989851",
            appId: "1:899003989851:web:e47df3198e73640e22647e",
            measurementId: "G-L3WMNTCW9G"
        };

        // Initialize Firebase (only if config is set)
        let database = null;
        let useFirebase = false;

        if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                database = firebase.database();
                useFirebase = true;
            } catch (error) {
                console.log("Firebase not configured, using local storage");
            }
        }

        // Team members with their colors
        const teamMembers = [
            { id: 'trey', name: 'Trey', color: 'forest' },
            { id: 'halie', name: 'Halie', color: 'ocean' },
            { id: 'ricardo', name: 'Ricardo', color: 'coral' },
            { id: 'team', name: 'Team', color: 'plant-green' }
        ];

        // Initial task data
        const initialTasks = [
            {
                id: 1,
                title: "Follow up with David Owen (OneSeason)",
                status: "in-progress",
                urgency: "this-week",
                priority: "high",
                dueDate: "2026-02-18",
                notes: "Grow room specs & harvest estimates",
                owner: "trey"
            },
            {
                id: 2,
                title: "Follow up with Tom Boothe (GreenDuct)",
                status: "in-progress",
                urgency: "this-week",
                priority: "high",
                dueDate: "2026-02-20",
                notes: "Awaiting response for call",
                owner: "trey"
            },
            {
                id: 3,
                title: "Draft RFP for fabric ducting vendors",
                status: "not-started",
                urgency: "next-week",
                priority: "high",
                dueDate: "2026-02-28",
                notes: "Include CFD modeling requirements",
                owner: "halie"
            },
            {
                id: 4,
                title: "Schedule Aubergine meeting",
                status: "not-started",
                urgency: "this-month",
                priority: "high",
                dueDate: "2026-03-08",
                notes: "Need production timeline first",
                owner: "trey"
            },
            {
                id: 5,
                title: "Develop sensor deployment spec",
                status: "not-started",
                urgency: "this-month",
                priority: "medium",
                dueDate: "2026-03-10",
                notes: "For Phase 1 pilot",
                owner: "ricardo"
            },
            {
                id: 6,
                title: "Obtain CFD modeling from vendors",
                status: "not-started",
                urgency: "this-month",
                priority: "medium",
                dueDate: "2026-03-30",
                notes: "Compare 2-3 systems",
                owner: "halie"
            },
            {
                id: 7,
                title: "Execute Phase 1 pilot (Bays 1-3)",
                status: "not-started",
                urgency: "future",
                priority: "high",
                dueDate: "2026-04-15",
                notes: "Full sensor network",
                owner: "team"
            }
        ];

        // Sprint utility functions
        const getNextWednesday = (fromDate = new Date()) => {
            const date = new Date(fromDate);
            const day = date.getDay();
            const daysUntilWednesday = day <= 3 ? 3 - day : 10 - day;
            date.setDate(date.getDate() + daysUntilWednesday);
            return date;
        };

        const getSprintDates = (sprintNumber) => {
            const firstWednesday = getNextWednesday(new Date('2026-02-17')); // Base sprint starts Feb 19
            const weeksToAdd = sprintNumber - 1;
            const startDate = new Date(firstWednesday);
            startDate.setDate(startDate.getDate() + (weeksToAdd * 7));
            
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6); // Tuesday (6 days after Wednesday)
            
            return { startDate, endDate };
        };

        const formatDate = (date) => {
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        };

        const formatDateRange = (startDate, endDate) => {
            return `${formatDate(startDate)} - ${formatDate(endDate)}`;
        };

        const getCurrentSprint = (sprints) => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return sprints.find(sprint => {
                const start = new Date(sprint.startDate);
                const end = new Date(sprint.endDate);
                return today >= start && today <= end;
            });
        };

        const isCurrentSprint = (sprint) => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const start = new Date(sprint.startDate);
            const end = new Date(sprint.endDate);
            return today >= start && today <= end;
        };

        const isFutureSprint = (sprint) => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const start = new Date(sprint.startDate);
            return start > today;
        };

        const vendors = [
            {
                id: 1,
                name: "David Owen",
                company: "OneSeason Farmers",
                role: "Grow room specs & harvest estimates",
                status: "Email sent this morning",
                email: "david@oneseason.com",
                phone: ""
            },
            {
                id: 2,
                name: "Tom Boothe",
                company: "GreenDuct",
                role: "Regional Sales Manager",
                status: "Email sent",
                email: "tom@greenduct.com",
                phone: ""
            },
            {
                id: 3,
                name: "Aubergine Owner",
                company: "Aubergine Restaurant",
                role: "16,000+ lbs/month partnership",
                status: "Awaiting production timeline",
                email: "",
                phone: ""
            }
        ];

        function App() {
            const [activeTab, setActiveTab] = useState('kanban');
            const [tasks, setTasks] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [draggedTask, setDraggedTask] = useState(null);
            const [synced, setSynced] = useState(false);
            const [editingTask, setEditingTask] = useState(null);
            const [openMenuId, setOpenMenuId] = useState(null);
            const [addToColumn, setAddToColumn] = useState('not-started');
            const [viewFilter, setViewFilter] = useState('all');
            const [showVendorModal, setShowVendorModal] = useState(false);
            const [vendorsList, setVendorsList] = useState(() => {
                const saved = localStorage.getItem('micosVendors');
                return saved ? JSON.parse(saved) : vendors;
            });
            const [sprints, setSprints] = useState(() => {
                const saved = localStorage.getItem('micosSprints');
                return saved ? JSON.parse(saved) : [];
            });
            const [selectedSprintId, setSelectedSprintId] = useState(null);
            const [showSprintModal, setShowSprintModal] = useState(false);
            const [googleAccessToken, setGoogleAccessToken] = useState(() => {
                return localStorage.getItem('googleAccessToken') || null;
            });
            const [lastSyncTime, setLastSyncTime] = useState(() => {
                return localStorage.getItem('lastSyncTime') || null;
            });
            const [syncStatus, setSyncStatus] = useState('');

            // Firebase Function URLs
            const FUNCTION_BASE = 'https://us-central1-mico-s-micro-farm-agile.cloudfunctions.net';

            // Load tasks on mount
            useEffect(() => {
                if (useFirebase && database) {
                    // Listen to Firebase
                    const tasksRef = database.ref('tasks');
                    tasksRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            setTasks(Object.values(data));
                            setSynced(true);
                        } else {
                            // Initialize with default tasks
                            initialTasks.forEach(task => {
                                database.ref('tasks/' + task.id).set(task);
                            });
                        }
                    });

                    return () => tasksRef.off();
                } else {
                    // Use localStorage as fallback
                    const saved = localStorage.getItem('micosTasks');
                    setTasks(saved ? JSON.parse(saved) : initialTasks);
                }
            }, []);

            // Auto-select current sprint and ensure 12 sprints exist
            useEffect(() => {
                // Create sprints up to 12 if we have fewer
                if (sprints.length < 12 && sprints.length > 0) {
                    const newSprints = [...sprints];
                    const startNumber = sprints.length + 1;
                    
                    for (let i = startNumber; i <= 12; i++) {
                        const { startDate, endDate } = getSprintDates(i);
                        newSprints.push({
                            id: Date.now() + i,
                            number: i,
                            name: `Sprint ${i}`,
                            goal: '',
                            startDate: startDate.toISOString(),
                            endDate: endDate.toISOString()
                        });
                    }
                    setSprints(newSprints);
                }

                // Auto-select current sprint if none selected
                if (sprints.length > 0 && !selectedSprintId) {
                    const current = getCurrentSprint(sprints);
                    const targetSprint = current || sprints[0]; // Fallback to first sprint if no current
                    setSelectedSprintId(targetSprint.id);
                }
            }, [sprints.length]);

            // Save sprints to localStorage
            useEffect(() => {
                localStorage.setItem('micosSprints', JSON.stringify(sprints));
            }, [sprints]);

            // Save to Firebase or localStorage
            const saveTasks = (updatedTasks) => {
                if (useFirebase && database) {
                    updatedTasks.forEach(task => {
                        database.ref('tasks/' + task.id).set(task);
                    });
                } else {
                    localStorage.setItem('micosTasks', JSON.stringify(updatedTasks));
                }
                setTasks(updatedTasks);
            };

            const handleDragStart = (task) => {
                setDraggedTask(task);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const handleDrop = (status) => {
                if (draggedTask) {
                    const updatedTasks = tasks.map(task =>
                        task.id === draggedTask.id ? { ...task, status } : task
                    );
                    saveTasks(updatedTasks);
                    setDraggedTask(null);
                }
            };

            const handlePlanningDrop = (targetSprintId) => {
                if (draggedTask) {
                    const updatedTasks = tasks.map(task =>
                        task.id === draggedTask.id ? { ...task, sprintId: targetSprintId } : task
                    );
                    saveTasks(updatedTasks);
                    setDraggedTask(null);
                }
            };

            const reorderBacklog = (taskId, newIndex) => {
                const backlogTasks = tasks.filter(t => !t.sprintId);
                const taskIndex = backlogTasks.findIndex(t => t.id === taskId);
                if (taskIndex === -1) return;

                const [movedTask] = backlogTasks.splice(taskIndex, 1);
                backlogTasks.splice(newIndex, 0, movedTask);

                // Update priority field based on new order
                const updatedTasks = tasks.map(task => {
                    const backlogIndex = backlogTasks.findIndex(t => t.id === task.id);
                    if (backlogIndex !== -1) {
                        return { ...task, backlogPriority: backlogIndex };
                    }
                    return task;
                });

                saveTasks(updatedTasks);
            };

            const getFilteredTasks = () => {
                if (viewFilter === 'all') return tasks;
                return tasks.filter(task => task.owner === viewFilter);
            };

            const getSprintTasks = () => {
                const filtered = getFilteredTasks();
                if (!selectedSprintId) {
                    // No sprint selected - show backlog (tasks with no sprint)
                    return filtered.filter(task => !task.sprintId);
                }
                return filtered.filter(task => task.sprintId === selectedSprintId);
            };

            const addTask = (taskData) => {
                const newTask = {
                    ...taskData,
                    id: Date.now(),
                    status: addToColumn,
                    sprintId: selectedSprintId // Auto-assign to currently displayed sprint
                };
                saveTasks([...tasks, newTask]);
                setShowModal(false);
            };

            const addSprint = (sprintData) => {
                const { startDate, endDate } = getSprintDates(sprints.length + 1);
                const newSprint = {
                    id: Date.now(),
                    number: sprints.length + 1,
                    name: sprintData.name || `Sprint ${sprints.length + 1}`,
                    goal: sprintData.goal || '',
                    startDate: startDate.toISOString(),
                    endDate: endDate.toISOString()
                };
                setSprints([...sprints, newSprint]);
                setShowSprintModal(false);
                setSelectedSprintId(newSprint.id);
            };

            const editTask = (taskData) => {
                const updatedTasks = tasks.map(task =>
                    task.id === taskData.id ? taskData : task
                );
                saveTasks(updatedTasks);
                setEditingTask(null);
                setOpenMenuId(null);
            };

            const deleteTask = (taskId) => {
                if (confirm('Are you sure you want to delete this task?')) {
                    const updatedTasks = tasks.filter(task => task.id !== taskId);
                    saveTasks(updatedTasks);
                    if (useFirebase && database) {
                        database.ref('tasks/' + taskId).remove();
                    }
                    setEditingTask(null);
                    setOpenMenuId(null);
                }
            };

            const addVendor = (vendorData) => {
                const newVendor = {
                    ...vendorData,
                    id: Date.now()
                };
                setVendorsList([...vendorsList, newVendor]);
                setShowVendorModal(false);
            };

            return (
                <div className="app-container">
                    {!useFirebase && (
                        <div className="setup-banner">
                            <h3>üîß Firebase Setup Required for Team Collaboration</h3>
                            <p>
                                Currently running in single-user mode. To enable real-time collaboration with Halie and Ricardo, 
                                you need to add your Firebase configuration. Instructions below! For now, you can use this locally 
                                and it will save to your browser.
                            </p>
                        </div>
                    )}

                    <div className="header">
                        <h1>üå± Mico's Micro Farm Agile</h1>
                        <div className="header-subtitle">
                            Airflow Upgrade & Facility Optimization
                            {useFirebase && synced && (
                                <span className="sync-status">
                                    <span className="sync-dot"></span>
                                    Live Sync Active
                                </span>
                            )}
                        </div>
                    </div>

                    <div className="tabs">
                        <button
                            className={`tab ${activeTab === 'kanban' ? 'active' : ''}`}
                            onClick={() => setActiveTab('kanban')}
                        >
                            üìã Kanban Board
                        </button>
                        <button
                            className={`tab ${activeTab === 'planning' ? 'active' : ''}`}
                            onClick={() => setActiveTab('planning')}
                        >
                            üìã Backlog & Planning
                        </button>
                        <button
                            className={`tab ${activeTab === 'calendar' ? 'active' : ''}`}
                            onClick={() => setActiveTab('calendar')}
                        >
                            üóìÔ∏è Calendar
                        </button>
                        <button
                            className={`tab ${activeTab === 'vendors' ? 'active' : ''}`}
                            onClick={() => setActiveTab('vendors')}
                        >
                            üë• Vendor Contacts
                        </button>
                    </div>

                    {activeTab === 'kanban' && (
                        <>
                            {sprints.length === 0 ? (
                                <div style={{ textAlign: 'center', padding: '60px 20px', background: 'white', borderRadius: '16px' }}>
                                    <h2 style={{ fontSize: '24px', marginBottom: '16px', color: 'var(--text-secondary)' }}>No Sprints Created Yet</h2>
                                    <p style={{ marginBottom: '24px', color: 'var(--text-secondary)' }}>Create your first sprint to start planning!</p>
                                    <button className="btn-create-sprint" onClick={() => setShowSprintModal(true)}>
                                        + Create First Sprint
                                    </button>
                                </div>
                            ) : (
                                <>
                                    {selectedSprintId && sprints.find(s => s.id === selectedSprintId) && (
                                        <SprintHeader 
                                            sprint={sprints.find(s => s.id === selectedSprintId)}
                                            sprints={sprints}
                                            selectedSprintId={selectedSprintId}
                                            onSelectSprint={setSelectedSprintId}
                                            onCreateSprint={() => setShowSprintModal(true)}
                                        />
                                    )}
                                    <ViewFilter value={viewFilter} onChange={setViewFilter} />
                                    <OwnerLegend />
                                    <KanbanBoard
                                        tasks={getSprintTasks()}
                                        onDragStart={handleDragStart}
                                        onDragOver={handleDragOver}
                                        onDrop={handleDrop}
                                        onAddTask={(columnId) => {
                                            setAddToColumn(columnId);
                                            setShowModal(true);
                                        }}
                                        openMenuId={openMenuId}
                                        onToggleMenu={setOpenMenuId}
                                        onEditTask={setEditingTask}
                                        onDeleteTask={deleteTask}
                                        onMoveTask={(taskId, newStatus) => {
                                            const updatedTasks = tasks.map(task =>
                                                task.id === taskId ? { ...task, status: newStatus } : task
                                            );
                                            saveTasks(updatedTasks);
                                            setOpenMenuId(null);
                                        }}
                                    />
                                </>
                            )}
                        </>
                    )}

                    {activeTab === 'planning' && (
                        <PlanningBoard
                            tasks={tasks}
                            sprints={sprints}
                            onDragStart={handleDragStart}
                            onDrop={handlePlanningDrop}
                            onReorderBacklog={reorderBacklog}
                            onCreateSprint={() => setShowSprintModal(true)}
                        />
                    )}
                    {activeTab === 'calendar' && <CalendarView tasks={tasks} />}
                    {activeTab === 'vendors' && (
                        <VendorsView 
                            vendors={vendorsList} 
                            onAddVendor={() => setShowVendorModal(true)}
                        />
                    )}

                    {showModal && (
                        <TaskModal
                            onClose={() => setShowModal(false)}
                            onSave={addTask}
                        />
                    )}

                    {editingTask && (
                        <TaskModal
                            task={editingTask}
                            onClose={() => setEditingTask(null)}
                            onSave={editTask}
                            onDelete={deleteTask}
                        />
                    )}

                    {showVendorModal && (
                        <VendorModal
                            onClose={() => setShowVendorModal(false)}
                            onSave={addVendor}
                        />
                    )}

                    {showSprintModal && (
                        <SprintModal
                            onClose={() => setShowSprintModal(false)}
                            onSave={addSprint}
                            sprintNumber={sprints.length + 1}
                        />
                    )}
                </div>
            );
        }

        function SprintHeader({ sprint, sprints, selectedSprintId, onSelectSprint, onCreateSprint }) {
            if (!sprint) return null;

            const current = isCurrentSprint(sprint);
            const future = isFutureSprint(sprint);
            const past = !current && !future;
            const startDate = new Date(sprint.startDate);
            const endDate = new Date(sprint.endDate);

            return (
                <>
                    {future && (
                        <div className="sprint-alert">
                            <div className="sprint-alert-icon">‚ö†Ô∏è</div>
                            <div className="sprint-alert-text">
                                VIEWING FUTURE SPRINT {sprint.number} - Tasks added here will be assigned to this future sprint
                            </div>
                        </div>
                    )}
                    {past && (
                        <div className="sprint-alert" style={{ background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)', border: '2px solid #d97706' }}>
                            <div className="sprint-alert-icon">üìÖ</div>
                            <div className="sprint-alert-text" style={{ color: '#92400e' }}>
                                VIEWING PAST SPRINT {sprint.number} - This sprint has already completed
                            </div>
                        </div>
                    )}
                    <div className="sprint-header">
                        <div className="sprint-info">
                            <div className="sprint-name" style={{ fontSize: current ? '20px' : '18px' }}>
                                {current && <span style={{ color: '#10b981', fontWeight: '800', marginRight: '8px' }}>‚óè CURRENT SPRINT</span>}
                                {sprint.name} - Sprint {sprint.number}
                            </div>
                            <div className="sprint-dates" style={{ fontSize: '15px', fontWeight: '600' }}>
                                {formatDateRange(startDate, endDate)}
                            </div>
                            {sprint.goal && (
                                <div className="sprint-goal">Goal: {sprint.goal}</div>
                            )}
                        </div>
                        <div className="sprint-selector">
                            <select 
                                className="sprint-select"
                                value={selectedSprintId}
                                onChange={(e) => onSelectSprint(Number(e.target.value))}
                            >
                                {sprints.map(s => (
                                    <option key={s.id} value={s.id}>
                                        {s.name} {isCurrentSprint(s) ? '(Current)' : ''} - {formatDateRange(new Date(s.startDate), new Date(s.endDate))}
                                    </option>
                                ))}
                            </select>
                            <button className="btn-create-sprint" onClick={onCreateSprint}>
                                + New Sprint
                            </button>
                        </div>
                    </div>
                </>
            );
        }

        function ViewFilter({ value, onChange }) {
            return (
                <div className="view-filter">
                    <span className="view-filter-label">View:</span>
                    <select 
                        className="view-filter-select"
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                    >
                        <option value="all">All Team</option>
                        {teamMembers.map(member => (
                            <option key={member.id} value={member.id}>
                                {member.name}'s Tasks
                            </option>
                        ))}
                    </select>
                </div>
            );
        }

        function OwnerLegend() {
            return (
                <div className="legend">
                    {teamMembers.map(member => (
                        <div key={member.id} className="legend-item">
                            <div className={`legend-color owner-${member.id}`}></div>
                            <span>{member.name}</span>
                        </div>
                    ))}
                </div>
            );
        }

        function KanbanBoard({ tasks, onDragStart, onDragOver, onDrop, onAddTask, openMenuId, onToggleMenu, onEditTask, onDeleteTask, onMoveTask }) {
            const columns = [
                { id: 'not-started', title: 'üìù Not Started', showAdd: true },
                { id: 'in-progress', title: 'üöÄ In Progress', showAdd: true },
                { id: 'roadblock', title: 'üöß Roadblock', showAdd: true },
                { id: 'done', title: '‚úÖ Done', showAdd: true }
            ];

            return (
                <div className="kanban-board">
                    {columns.map(column => (
                        <div
                            key={column.id}
                            className={`column ${column.id}`}
                            onDragOver={onDragOver}
                            onDrop={() => onDrop(column.id)}
                        >
                            <div className="column-header">
                                <div className="column-title">
                                    {column.title}
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <div className="column-count">
                                        {tasks.filter(t => t.status === column.id).length}
                                    </div>
                                    {column.showAdd && (
                                        <button 
                                            className="column-add-btn"
                                            onClick={() => onAddTask(column.id)}
                                            title="Add task"
                                        >
                                            +
                                        </button>
                                    )}
                                </div>
                            </div>
                            {tasks
                                .filter(task => task.status === column.id)
                                .map(task => (
                                    <TaskCard
                                        key={task.id}
                                        task={task}
                                        onDragStart={() => onDragStart(task)}
                                        isMenuOpen={openMenuId === task.id}
                                        onToggleMenu={() => onToggleMenu(openMenuId === task.id ? null : task.id)}
                                        onEdit={() => onEditTask(task)}
                                        onDelete={() => onDeleteTask(task.id)}
                                        onMove={(newStatus) => onMoveTask(task.id, newStatus)}
                                    />
                                ))}
                        </div>
                    ))}
                </div>
            );
        }

        function TaskCard({ task, onDragStart, isMenuOpen, onToggleMenu, onEdit, onDelete, onMove }) {
            const [showSubmenu, setShowSubmenu] = React.useState(false);
            const owner = teamMembers.find(m => m.id === task.owner);
            
            const statusOptions = [
                { id: 'not-started', label: 'üìù Not Started' },
                { id: 'in-progress', label: 'üöÄ In Progress' },
                { id: 'done', label: '‚úÖ Done' }
            ];
            
            return (
                <div
                    className={`task-card priority-${task.priority}`}
                    draggable
                    onDragStart={onDragStart}
                >
                    <button 
                        className="task-menu-button"
                        onClick={(e) => {
                            e.stopPropagation();
                            onToggleMenu();
                            setShowSubmenu(false);
                        }}
                    >
                        ‚ãÆ
                    </button>
                    
                    {isMenuOpen && (
                        <div className="task-menu-dropdown" onClick={(e) => e.stopPropagation()}>
                            <button 
                                className="task-menu-item"
                                onClick={(e) => {
                                    e.stopPropagation();
                                    onEdit();
                                    onToggleMenu();
                                }}
                            >
                                ‚úèÔ∏è Edit
                            </button>
                            <button 
                                className="task-menu-item move"
                                onMouseEnter={() => setShowSubmenu(true)}
                                onMouseLeave={() => setShowSubmenu(false)}
                                onClick={(e) => {
                                    e.stopPropagation();
                                    setShowSubmenu(!showSubmenu);
                                }}
                            >
                                ‚û°Ô∏è Move to...
                                {showSubmenu && (
                                    <div className="task-submenu">
                                        {statusOptions
                                            .filter(option => option.id !== task.status)
                                            .map(option => (
                                                <button
                                                    key={option.id}
                                                    className="task-submenu-item"
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        onMove(option.id);
                                                        setShowSubmenu(false);
                                                    }}
                                                >
                                                    {option.label}
                                                </button>
                                            ))}
                                    </div>
                                )}
                            </button>
                            <button 
                                className="task-menu-item delete"
                                onClick={(e) => {
                                    e.stopPropagation();
                                    onDelete();
                                    onToggleMenu();
                                }}
                            >
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    )}

                    <div className="task-header">
                        <div className="task-title">{task.title}</div>
                        {owner && (
                            <div className={`task-owner-badge owner-${owner.id}`}>
                                {owner.name}
                            </div>
                        )}
                    </div>
                    <div className="task-meta">
                        <span className={`task-badge urgency-${task.urgency}`}>
                            {task.urgency.replace('-', ' ')}
                        </span>
                        <span className={`priority-badge priority-${task.priority}`}>
                            {task.priority}
                        </span>
                        {task.dueDate && (
                            <span className="task-date">üìÖ {task.dueDate}</span>
                        )}
                    </div>
                    {task.notes && (
                        <div className="task-notes">
                            {task.notes}
                        </div>
                    )}
                </div>
            );
        }

        function TimelineView({ tasks }) {
            const sections = [
                { id: 'this-week', title: 'üî• This Week', urgency: 'this-week' },
                { id: 'next-week', title: '‚è≠Ô∏è Next Week', urgency: 'next-week' },
                { id: 'this-month', title: 'üìÜ This Month', urgency: 'this-month' },
                { id: 'future', title: 'üîÆ Future', urgency: 'future' }
            ];

            return (
                <div className="timeline-view">
                    <OwnerLegend />
                    {sections.map(section => (
                        <div key={section.id} className="timeline-section">
                            <div className="timeline-title">{section.title}</div>
                            <div className="timeline-tasks">
                                {tasks
                                    .filter(task => task.urgency === section.urgency)
                                    .map(task => (
                                        <TaskCard key={task.id} task={task} />
                                    ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function PlanningBoard({ tasks, sprints, onDragStart, onDrop, onReorderBacklog, onCreateSprint }) {
            const [dragOverColumn, setDragOverColumn] = useState(null);
            const boardRef = React.useRef(null);

            const backlogTasks = tasks
                .filter(t => !t.sprintId)
                .sort((a, b) => (a.backlogPriority || 999) - (b.backlogPriority || 999));

            const getSprintTasks = (sprintId) => {
                return tasks.filter(t => t.sprintId === sprintId);
            };

            // Get unique months from sprints
            const getMonthsFromSprints = () => {
                const months = new Map();
                sprints.forEach(sprint => {
                    const date = new Date(sprint.startDate);
                    const monthKey = `${date.getFullYear()}-${date.getMonth()}`;
                    const monthName = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    if (!months.has(monthKey)) {
                        months.set(monthKey, { key: monthKey, name: monthName, sprintId: sprint.id });
                    }
                });
                return Array.from(months.values());
            };

            const scrollToSprint = (sprintId) => {
                if (!boardRef.current) return;
                const sprintElement = boardRef.current.querySelector(`[data-sprint-id="${sprintId}"]`);
                if (sprintElement) {
                    sprintElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
                }
            };

            const handleMonthJump = (monthKey) => {
                if (!monthKey) return;
                const [year, month] = monthKey.split('-').map(Number);
                const targetSprint = sprints.find(sprint => {
                    const sprintDate = new Date(sprint.startDate);
                    return sprintDate.getFullYear() === year && sprintDate.getMonth() === month;
                });
                if (targetSprint) {
                    scrollToSprint(targetSprint.id);
                }
            };

            const handleSprintJump = (sprintId) => {
                if (sprintId) {
                    scrollToSprint(Number(sprintId));
                }
            };

            return (
                <div style={{ position: 'relative' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                        <h2 style={{ fontSize: '24px', fontWeight: '700' }}>üìã Sprint Planning</h2>
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                            <select 
                                className="sprint-select"
                                onChange={(e) => handleMonthJump(e.target.value)}
                                defaultValue=""
                                style={{ minWidth: '120px' }}
                            >
                                <option value="">Jump to Month</option>
                                {getMonthsFromSprints().map(month => (
                                    <option key={month.key} value={month.key}>{month.name}</option>
                                ))}
                            </select>
                            <select 
                                className="sprint-select"
                                onChange={(e) => handleSprintJump(e.target.value)}
                                defaultValue=""
                                style={{ minWidth: '220px' }}
                            >
                                <option value="">Jump to Sprint</option>
                                {sprints.map(sprint => (
                                    <option key={sprint.id} value={sprint.id}>
                                        Sprint {sprint.number} ({formatDateRange(new Date(sprint.startDate), new Date(sprint.endDate))})
                                    </option>
                                ))}
                            </select>
                            <button className="btn-create-sprint" onClick={onCreateSprint}>
                                + Create Sprint
                            </button>
                        </div>
                    </div>
                    <div className="planning-board-container" ref={boardRef}>
                        {/* Fixed Backlog Column */}
                        <div className="planning-backlog-fixed">
                            <div 
                                className="planning-column backlog"
                                onDragOver={(e) => {
                                    e.preventDefault();
                                    setDragOverColumn('backlog');
                                }}
                                onDrop={() => {
                                    onDrop(null);
                                    setDragOverColumn(null);
                                }}
                            >
                                <div className="planning-column-header">
                                    <div className="planning-column-title">üìã Backlog</div>
                                    <div className="planning-column-subtitle">{backlogTasks.length} tasks</div>
                                </div>
                                {backlogTasks.length === 0 ? (
                                    <div className="drag-indicator">No tasks in backlog</div>
                                ) : (
                                    backlogTasks.map((task, index) => (
                                        <PlanningTaskCard
                                            key={task.id}
                                            task={task}
                                            onDragStart={() => onDragStart(task)}
                                        />
                                    ))
                                )}
                            </div>
                        </div>

                        {/* Scrollable Sprint Columns */}
                        <div className="planning-sprints-scroll">
                            {sprints.map(sprint => {
                                const sprintTasks = getSprintTasks(sprint.id);
                                const isCurrent = isCurrentSprint(sprint);
                                
                                return (
                                    <div
                                        key={sprint.id}
                                        data-sprint-id={sprint.id}
                                        className="planning-column sprint"
                                        style={{ minWidth: '280px', flexShrink: 0 }}
                                        onDragOver={(e) => {
                                            e.preventDefault();
                                            setDragOverColumn(sprint.id);
                                        }}
                                        onDrop={() => {
                                            onDrop(sprint.id);
                                            setDragOverColumn(null);
                                        }}
                                    >
                                        <div className="planning-column-header">
                                            <div className="planning-column-title">
                                                Sprint {sprint.number} {isCurrent && '‚úì'}
                                            </div>
                                            <div className="planning-column-subtitle">
                                                {formatDateRange(new Date(sprint.startDate), new Date(sprint.endDate))}
                                            </div>
                                            <div className="planning-column-subtitle" style={{ marginTop: '4px' }}>
                                                {sprintTasks.length} tasks
                                            </div>
                                        </div>
                                        {sprintTasks.length === 0 ? (
                                            <div className="drag-indicator">Drag tasks here</div>
                                        ) : (
                                            sprintTasks.map(task => (
                                                <PlanningTaskCard
                                                    key={task.id}
                                                    task={task}
                                                    onDragStart={() => onDragStart(task)}
                                                />
                                            ))
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        function PlanningTaskCard({ task, onDragStart }) {
            const owner = teamMembers.find(m => m.id === task.owner);
            
            return (
                <div
                    className="planning-task-card"
                    draggable
                    onDragStart={onDragStart}
                >
                    <div className="planning-task-title">{task.title}</div>
                    <div className="planning-task-meta">
                        {task.size && (
                            <span className="planning-task-size">{task.size}</span>
                        )}
                        <span className={`priority-badge priority-${task.priority}`}>
                            {task.priority}
                        </span>
                        {owner && (
                            <div className={`task-owner-badge owner-${owner.id}`}>
                                {owner.name}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function CalendarView({ tasks }) {
            const today = new Date();
            
            return (
                <div className="calendar-view">
                    <div className="calendar-header">
                        <div className="calendar-title">
                            {today.toLocaleString('default', { month: 'long', year: 'numeric' })}
                        </div>
                    </div>
                    <OwnerLegend />
                    <div style={{ fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '20px', marginTop: '20px' }}>
                        Tasks with deadlines sorted by due date
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
                        {tasks
                            .filter(task => task.dueDate)
                            .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                            .map(task => (
                                <TaskCard key={task.id} task={task} />
                            ))}
                    </div>
                </div>
            );
        }

        function VendorsView({ vendors, onAddVendor }) {
            return (
                <div className="vendors-view">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '28px' }}>
                        <h2 style={{ fontSize: '28px', fontWeight: '700' }}>ü§ù Vendor Contacts</h2>
                        <button className="btn btn-primary" onClick={onAddVendor}>
                            + Add Contact
                        </button>
                    </div>
                    {vendors.map(vendor => (
                        <div key={vendor.id} className="vendor-card">
                            <div className="vendor-name">{vendor.name}</div>
                            <div className="vendor-info">
                                <div><strong>Company:</strong> {vendor.company}</div>
                                <div><strong>Role:</strong> {vendor.role}</div>
                                <div><strong>Status:</strong> {vendor.status}</div>
                                {vendor.email && <div><strong>Email:</strong> {vendor.email}</div>}
                                {vendor.phone && <div><strong>Phone:</strong> {vendor.phone}</div>}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function TaskModal({ task, onClose, onSave, onDelete }) {
            const isEditing = !!task;
            const [formData, setFormData] = useState(task || {
                title: '',
                urgency: 'this-week',
                priority: 'medium',
                dueDate: '',
                notes: '',
                owner: 'trey',
                status: 'not-started'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h2 className="modal-title">{isEditing ? 'Edit Task' : 'Add New Task'}</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Task Title</label>
                                <input
                                    className="form-input"
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Task Owner</label>
                                <select
                                    className="form-select"
                                    value={formData.owner}
                                    onChange={(e) => setFormData({ ...formData, owner: e.target.value })}
                                >
                                    {teamMembers.map(member => (
                                        <option key={member.id} value={member.id}>{member.name}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Urgency</label>
                                <select
                                    className="form-select"
                                    value={formData.urgency}
                                    onChange={(e) => setFormData({ ...formData, urgency: e.target.value })}
                                >
                                    <option value="this-week">This Week</option>
                                    <option value="next-week">Next Week</option>
                                    <option value="this-month">This Month</option>
                                    <option value="future">Future</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Priority</label>
                                <select
                                    className="form-select"
                                    value={formData.priority}
                                    onChange={(e) => setFormData({ ...formData, priority: e.target.value })}
                                >
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Size</label>
                                <select
                                    className="form-select"
                                    value={formData.size || ''}
                                    onChange={(e) => setFormData({ ...formData, size: e.target.value })}
                                >
                                    <option value="">Not sized</option>
                                    <option value="S">S - Small (1 day or less)</option>
                                    <option value="M">M - Medium (1-2 days)</option>
                                    <option value="L">L - Large (3+ days)</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Due Date</label>
                                <input
                                    className="form-input"
                                    type="date"
                                    value={formData.dueDate}
                                    onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Notes</label>
                                <textarea
                                    className="form-textarea"
                                    value={formData.notes}
                                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                                    placeholder="Add any additional details..."
                                />
                            </div>
                            <div className="form-actions" style={{ justifyContent: isEditing ? 'space-between' : 'flex-end' }}>
                                {isEditing && (
                                    <button 
                                        type="button" 
                                        className="btn" 
                                        onClick={() => onDelete(task.id)}
                                        style={{ background: '#fee2e2', color: '#991b1b' }}
                                    >
                                        üóëÔ∏è Delete
                                    </button>
                                )}
                                <div style={{ display: 'flex', gap: '12px' }}>
                                    <button type="button" className="btn btn-secondary" onClick={onClose}>
                                        Cancel
                                    </button>
                                    <button type="submit" className="btn btn-primary">
                                        {isEditing ? 'Save Changes' : 'Add Task'}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function VendorModal({ onClose, onSave }) {
            const [formData, setFormData] = useState({
                name: '',
                company: '',
                role: '',
                status: '',
                email: '',
                phone: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h2 className="modal-title">Add New Contact</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Contact Name</label>
                                <input
                                    className="form-input"
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Company</label>
                                <input
                                    className="form-input"
                                    type="text"
                                    value={formData.company}
                                    onChange={(e) => setFormData({ ...formData, company: e.target.value })}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Role / Purpose</label>
                                <input
                                    className="form-input"
                                    type="text"
                                    value={formData.role}
                                    onChange={(e) => setFormData({ ...formData, role: e.target.value })}
                                    placeholder="e.g., Supplier, Partner, Client"
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Status</label>
                                <input
                                    className="form-input"
                                    type="text"
                                    value={formData.status}
                                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                    placeholder="e.g., Active, Awaiting response"
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Email</label>
                                <input
                                    className="form-input"
                                    type="email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Phone</label>
                                <input
                                    className="form-input"
                                    type="tel"
                                    value={formData.phone}
                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                                />
                            </div>
                            <div className="form-actions">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                                <button type="submit" className="btn btn-primary">
                                    Add Contact
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function SprintModal({ onClose, onSave, sprintNumber }) {
            const [formData, setFormData] = useState({
                name: `Sprint ${sprintNumber}`,
                goal: ''
            });

            const { startDate, endDate } = getSprintDates(sprintNumber);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <h2 className="modal-title">Create New Sprint</h2>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Sprint Name</label>
                                <input
                                    className="form-input"
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Sprint Dates (Auto-calculated)</label>
                                <div style={{ padding: '12px', background: 'var(--earth-tan)', borderRadius: '8px', fontSize: '14px', fontWeight: '500' }}>
                                    {formatDateRange(startDate, endDate)}
                                </div>
                                <div style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '4px' }}>
                                    Wednesday to Tuesday, 1-week duration
                                </div>
                            </div>
                            <div className="form-group">
                                <label className="form-label">Sprint Goal (Optional)</label>
                                <textarea
                                    className="form-textarea"
                                    value={formData.goal}
                                    onChange={(e) => setFormData({ ...formData, goal: e.target.value })}
                                    placeholder="e.g., Complete airflow system installation"
                                    rows="3"
                                />
                            </div>
                            <div className="form-actions">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    Cancel
                                </button>
                                <button type="submit" className="btn btn-primary">
                                    Create Sprint
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

    <!-- 
    ============================================
    FIREBASE SETUP INSTRUCTIONS
    ============================================
    
    1. Go to https://console.firebase.google.com/
    2. Click "Add project" or select existing
    3. Enable "Realtime Database" in Build menu
    4. Set security rules to:
       {
         "rules": {
           "tasks": {
             ".read": true,
             ".write": true
           }
         }
       }
    5. Go to Project Settings > Your apps
    6. Click "Web app" icon to register app
    7. Copy the firebaseConfig object
    8. Replace the firebaseConfig above (line ~470) with your actual config
    
    Once configured, the banner will disappear and everyone 
    with this file will see live updates!
    -->
</body>
</html>
